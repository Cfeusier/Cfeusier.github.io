<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>The Language Features of JavaScript that Create Closure</title>
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,300,600,700' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans+Condensed:300' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="http://clarkfeusier.com/css/base.css">
    <link rel="shortcut icon" type="image/x-icon" href="http://clarkfeusier.com/img/favicon.ico" />
    <script type="text/javascript" src="http://clarkfeusier.com/vendor/syntaxhighlighter_3.0.83/scripts/shCore.js"></script>
    <script type="text/javascript" src="http://clarkfeusier.com/vendor/syntaxhighlighter_3.0.83/scripts/shBrushSql.js"></script>
    <script type="text/javascript" src="http://clarkfeusier.com/vendor/syntaxhighlighter_3.0.83/scripts/shBrushRuby.js"></script>
    <script type="text/javascript" src="http://clarkfeusier.com/vendor/syntaxhighlighter_3.0.83/scripts/shBrushBash.js"></script>
    <script type="text/javascript" src="http://clarkfeusier.com/vendor/syntaxhighlighter_3.0.83/scripts/shBrushYaml.js"></script>
    <script type="text/javascript" src="http://clarkfeusier.com/vendor/syntaxhighlighter_3.0.83/scripts/shBrushCss.js"></script>
    <script type="text/javascript" src="http://clarkfeusier.com/vendor/syntaxhighlighter_3.0.83/scripts/shBrushJScript.js"></script>
    <link href="http://clarkfeusier.com/vendor/syntaxhighlighter_3.0.83/styles/shCore.css" rel="stylesheet" type="text/css" />
    <link href="http://clarkfeusier.com/vendor/syntaxhighlighter_3.0.83/styles/shThemeDefault.css" rel="stylesheet" type="text/css" />
</head>
<body>
    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-P9FNCG" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-P9FNCG');
    </script>
    <!-- End Google Tag Manager -->
    <!-- Setup SyntaxHighlighter -->
    <script type="text/javascript">SyntaxHighlighter.all()</script>
    <!-- End SyntaxHighlighter Setup -->
    <header>
        <div id="logo">
            <img src="http://clarkfeusier.com/img/headshot.png" alt="">
        </div>
        <div id="site-heading">
            <h2 class="title">Clark Feusier</h2>
            <h3 class="subtitle">Software Engineer and Metalogician</h3>
        </div>
        <ul id="nav">
         <li class=""><a href="http://clarkfeusier.com/pages/about">About</a></li>
         <li class=""><a href="http://clarkfeusier.com/index.html">Writing</a></li>
         <li class=""><a href="http://clarkfeusier.com/pages/portfolio">Portfolio</a></li>
         <li><a href="#" id="contact-section">Contact</a></li>
     </ul>
     <div id="contact-wrapper">
        <div id="contact-content">
            <ul id="contact-list">
                <i class="fa fa-envelope-o contact-icon"></i>
                <li><a href="mailto:cfeusier@gmail.com">  cfeusier@gmail.com</a></li>
                <li class="separator">/</li>
                <li><a href="http://github.com/cfeusier"><i class="fa fa-github"></i></a></li>
                <li><a href="http://twitter.com/clarkfeusier"><i class="fa fa-twitter"></i></a></li>
                <li><a href="http://facebook.com/cfeusier"><i class="fa fa-facebook"></i></a></li>
                <li><a href="http://linkedin.com/in/clarkfeusier"><i class="fa fa-linkedin"></i></a></li>
            </ul>
        </div>
        <a href="#" id="contact-close"><i class="fa fa-times"></i></a>
    </div>
</header>
<div id="main-contents">
<div class="single-post">
    <div class="container">
        <div class="post-item">
            <div class="post-header">
                <div class="blog-no-header"></div>
            </div>
            <div class="post-body">
                <div class="meta">
                    <span class="date">28 February 2015</span>
                </div>
                <h2 class="title">The Language Features of JavaScript that Create Closure</h2>
                <div class="content">
                    <p>This will be a very simple post covering the language features of JavaScript that create <strong>closure</strong>. Basically, I just want to sing you a little ditty about closures — what they are and how they come about in JavaScript.</p>

<p>Our post will follow this outline:</p>

<ol>
  <li>the definition of a closure</li>
  <li>the requisite parts of a closure</li>
  <li>a brief explanation of <em>scope</em> in JavaScript — both lexical and dynamic scope</li>
  <li>the necessary features of the JavaScript language that allow for closure</li>
</ol>

<p><strong>Note</strong>: from here on, I will assume that I am only talking about closure in <em>JavaScript</em></p>

<blockquote>
    <strong>Credit</strong> to <a href="https://twitter.com/mracus" target="_blank">@mracus</a> for the awesome lecture, from which my following notes were derived. Anything good in this post is credit to him, and anything incorrect is probably because of my misunderstanding.
</blockquote>

<p>Let’s break it down, yo.</p>

<hr />

<h2 id="the-definition-of-a-closure">The Definition of a Closure</h2>

<p>A <strong>closure</strong> is a <strong><em>function</em></strong> object that retains <strong>ongoing access</strong> to the variables of the context <em>in which it was created</em>.</p>

<p>For a less formal specification — a closure is pretty much just a function object that was <strong><em>defined within</em></strong> and <strong><em>returned by</em></strong> another function. That is, a closure is a reference to a function object that was defined and returned by an ‘outer’ function.</p>

<p>If the concept of a closure isn’t clear from the above definitions, the following examination of the different components of a closure help clarify.</p>

<h2 id="the-requisite-parts-of-a-closure">The Requisite Parts of a Closure</h2>

<ol>
  <li>an <strong>outer</strong> function with variables</li>
</ol>

<script src="https://gist.github.com/Cfeusier/654300c9bdecd7597441.js"></script>

<ol>
  <li>an <strong>inner</strong> function that references variables in the outer function</li>
</ol>

<script src="https://gist.github.com/Cfeusier/e48f5cafed64132c08d2.js"></script>

<ol>
  <li>the inner function is <strong>returned</strong> by the outer function</li>
</ol>

<script src="https://gist.github.com/Cfeusier/d100585e61ab18e07606.js"></script>

<p>As you can see, our final code snippet illustrates a closure, summarized as follows:</p>

<ol>
  <li>a closure function <strong>closes over</strong> (encloses) the closure-scoped variables</li>
  <li>the declaration of the closure function is returned by the outer function</li>
  <li>the closure function references a variable from its context (the outer function)</li>
  <li>when the closure function is executed, it can access the variables referenced in even though the outer function has already finished execution</li>
</ol>

<p>We now have the concept of a closure in front of us, but we need to understand how <strong>scoping</strong> works in JavaScript before we can truly understanding closures and their power. Remember, a <strong>closure</strong> is a function that retains ongoing access to the variables from the <strong>scope</strong> in which the closure function was created. So, to understand closures, we need to understand how scoping works in JavaScript.</p>

<h2 id="an-aside-about-scope-in-javascript">An Aside about Scope in JavaScript</h2>

<p>First, let’s clear the air — <strong>scope</strong> is an ambiguous term when used by JavaScripters. Most of the misunderstanding and confusion surrounding scoping comes from engineers’ continual equivocation between <strong>two</strong> <em>different</em> concepts of scope — <strong>lexical</strong> and <strong>dynamic</strong>. This section will pull apart those two concepts, so that we can understand them properly.</p>

<h3 id="lexical-scope">Lexical Scope</h3>

<blockquote>the region of source code where a <em>variable name</em> reference has <strong>meaning</strong></blockquote>

<p>JavaScript lexically scopes variable name reference to the <strong>function</strong> (ignoring ES6 <code>let</code> and the like), which means that <strong><em>every function body has a corresponding lexical scope</em></strong>. Take a look at the following code snippet, and then we will discuss.</p>

<script src="https://gist.github.com/Cfeusier/de557a076731ad8b321e.js"></script>

<p>JavaScript has <strong>global</strong> and <strong>local</strong> variables — any variable declared outside of a function is <strong>global</strong>, while any variable declared within a function is <strong>locally</strong> scoped to that function. So, on line 2, we declare and initialize a global variable named <code>globalVariable</code>, and we store the value <code>"got lipstick stamps on my passport"</code> in the <code>globalVariable</code> name-bucket. We can access this variable anywhere in our program, hence <code>global</code> — line 19 would log out the value stored in <code>globalVariable</code>.</p>

<p>The function <code>newScopeAboutToOpenHere</code> (lines 4 - 8) opens a local scope, in which we declare and initialize the name <code>localVariable</code> to the value <code>"never left the shire"</code>. This variable is <strong><em>local</em></strong> to the function in which it was declared in the sense that the variable name <code>localVariable</code> doesn’t successfully refer to anything <strong>outside</strong> of the function <code>newScopeAboutToOpenHere</code>. The <code>console.log</code> statement of <code>localVariable</code> on line 20, outside of the <code>newScopeAboutToOpenHere</code> function, would throw a <strong>reference</strong> error because the variable doesn’t refer to anything valid in the global scope because the variable is local. We can only access the value stored at that name reference if the value is <strong>returned</strong> from the function to which the variable is locally scoped. We access <code>"never left the shire"</code> from outside of the shire by invoking <code>newScopeAboutToOpenHere</code> on line 21, which explicitly returns <code>localVariable</code>.</p>

<p>Finally, local scopes can be nested, as seen on lines 10 to 17.</p>

<p>We were able to determine the <strong>lexical scope</strong> of the variables by merely <strong>reading</strong> the source code, that is, without running the code. In this sense, lexical scope is <strong>static</strong> — not dynamic. A variable is <em>lexically</em> scoped to a function as long as the variable name occurs <strong>within the function’s body</strong> and represents a valid variable name within the function’s lexicon (also called the “variable’s local lexical environment”). Another way of saying it is: a variable’s <em>lexical</em> scope is the <strong>part of a program</strong> where a binding between the variable and a value is valid.</p>

<p>We can contrast this type of scoping, based on static parts of a program, with a type of scoping for a variable that is determined based on the <strong>time</strong> that a function executes while a program is running. Let’s discuss this type of <strong>dynamic</strong> scope now, which will also clarify any lingering confusion around lexical scope.</p>

<h3 id="dynamic-scope">Dynamic Scope</h3>

<blockquote>the in-memory storage system for holding a mapping of the available variables and values available to a function during execution</blockquote>

<p><strong>Note</strong>: though <em>dynamic scope</em> is also called <em>in-memory scope</em> and <em>execution context</em>, I will use the terms interchangeably.</p>

<p>As discussed above, JavaScript scopes variables to functions, meaning that the <strong>dynamic scope</strong> of a variable is the in-memory mapping of variable names and values available <strong>during a particular execution</strong> of the function to which the variable is scoped.</p>

<p>if a variable name’s scope is a certain function, then its scope is the time-period during which the function is executing: while the function is running, the variable name exists, and is bound to its variable, but after the function returns, the variable name does not exist
- a new dynamic scope is created anew for every invocation of a function to isolate the running of each function
- the current execution context is where the interpreter first does lookup for a given variable</p>

<h2 id="the-features-of-javasscript-that-allow-for-closure">The Features of JavasScript that Allow for Closure</h2>

<hr />

<h2 id="summary">Summary</h2>

<hr />

<h1 id="working-notes">WORKING NOTES</h1>

<h2 id="scopes">Scopes</h2>

<ol>
  <li>default scope in JavaScript is global</li>
  <li>‘{‘ of a function declaration delimits the entry to a new lexical scope</li>
  <li>lexical scope enforces access rules</li>
  <li>scopes can be nested</li>
  <li>variables are either global or local to a single function (lexically scoped)</li>
  <li>lexical scopes have one-to-many relationships with in-memory scopes (1 lexical scope for the code—n dynamic scopes, with one for each invocation of the function associated with that scope
program run</li>
  <li>thus, for each lexical scope there could be 0-many in-memory scopes/execution contexts (depending on how many times the function has been executed)</li>
</ol>

<h3 id="function-properties-language-features-that-allow-for-closures-in-js">function properties (language features) that allow for closures in JS:</h3>

<ol>
  <li>fn1 can/must explicitly return value (or value gets GCed)</li>
  <li>fn1 can return fn2 as explicit return value</li>
  <li>fn2 can retain access to the context in which it was created</li>
  <li>fn1 returns fn2 as explict value</li>
  <li>fn2 references variable A in fn1</li>
  <li>fn1 gets executed and stored in variable as fn2</li>
  <li>variable A disappears when execution is done</li>
  <li>fn2 gets executed</li>
  <li>fn2 can access variable A, even though the fn1’s execution context (intuitively) should have disappeared at this point</li>
</ol>

                </div>
            </div>
            <div class="post-tags">
                <i class="fa fa-tags"></i>
                
                <a class="tag_list_link" href="http://clarkfeusier.com/tag/javascript">javascript</a>
                <span class="seperator">,</span>
                
                <a class="tag_list_link" href="http://clarkfeusier.com/tag/closures">closures</a>
                <span class="seperator">,</span>
                
                <a class="tag_list_link" href="http://clarkfeusier.com/tag/computer science">computer science</a>
                <span class="seperator">,</span>
                
                <a class="tag_list_link" href="http://clarkfeusier.com/tag/language">language</a>
                <span class="seperator">,</span>
                
            </div>
            <ul class="post-socials">
                <li><a href="https://www.facebook.com/sharer/sharer.php?u=http://clarkfeusier.com/2015/02/28/language-features-and-closures-in-javascript/&t=The Language Features of JavaScript that Create Closure" target="_blank"><i class="fa fa-facebook"></i></a></li>
                <li><a href="https://twitter.com/intent/tweet?original_referer=http://clarkfeusier.com/2015/02/28/language-features-and-closures-in-javascript/&text=The Language Features of JavaScript that Create Closure&url=http://clarkfeusier.com/2015/02/28/language-features-and-closures-in-javascript/" target="_blank"><i class="fa fa-twitter"></i></a></li>
                <li><a href="https://plus.google.com/share?url=http://clarkfeusier.com/2015/02/28/language-features-and-closures-in-javascript/" target="_blank"><i class="fa fa-google-plus"></i></a></li>
            </ul>
        </div>
    </div>
    <div id="blog-pagination">
        <ul>
        	
            <li class="prev"><a href="http://clarkfeusier.com/2015/02/19/variable-hoisting-function-hoisting-javascript/"><i class="fa fa-angle-left"></i><span>Prev</span></a></li>
            
            
            <li class="separator"></li>
            
            
        </ul>
    </div>
</div>
 </div>
       <footer>
            <div id="footer-quote">
                <div class="container">
                    <div class="contents">
                        <div class="quote-icon">
                            <i class="fa fa-quote-right"></i>
                        </div>
                        <span class="quote-name">Percy Bysshe Shelley</span>
                        <div class="quote-text">
                            The soul's joy lies in <span class="colored-text">doing</span>.
                        </div>
                    </div>
                </div>
            </div>
            <div id="bottom">
                <div class="container foot">
                    <ul id="social-icons">
                        <li><a href="http://github.com/cfeusier"><i class="fa fa-github"></i></a></li>
                        <li><a href="http://twitter.com/clarkfeusier"><i class="fa fa-twitter"></i></a></li>
                        <li><a href="http://facebook.com/cfeusier"><i class="fa fa-facebook"></i></a></li>
                        <li><a href="http://linkedin.com/in/clarkfeusier"><i class="fa fa-linkedin"></i></a></li>
                    </ul>
                    <div id="copyright">© COPYRIGHT 2015 Clark Feusier</div>
                    <a id="home-circle" href="http://clarkfeusier.com"><i class="fa fa-home"></i></a>
                </div>
            </div>
       </footer>
       <script type="text/javascript" src="http://clarkfeusier.com/js/jquery-1.11.0.min.js"></script>
       <script type="text/javascript" src="http://clarkfeusier.com/js/header_glitter.js"></script>
    </body>
</html>